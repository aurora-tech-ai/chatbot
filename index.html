<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-AI Chatbot - Interface Avan√ßada</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    animation: {
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'float': 'float 6s ease-in-out infinite',
                        'glow': 'glow 2s ease-in-out infinite',
                        'slide-up': 'slideUp 0.3s ease-out',
                        'fade-in': 'fadeIn 0.5s ease-out',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0px)' },
                            '50%': { transform: 'translateY(-20px)' },
                        },
                        glow: {
                            '0%, 100%': { opacity: 1 },
                            '50%': { opacity: 0.5 },
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(10px)', opacity: 0 },
                            '100%': { transform: 'translateY(0)', opacity: 1 },
                        },
                        fadeIn: {
                            '0%': { opacity: 0 },
                            '100%': { opacity: 1 },
                        }
                    }
                }
            }
        }
    </script>
    
    <!-- Alpine.js -->
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Animate.css -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    
    <!-- Prism.js -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-typescript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-jsx.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-sql.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-json.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-yaml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-markdown.min.js"></script>
    
    <!-- Marked.js -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Particles.js -->
    <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
    
    <!-- Custom Styles -->
    <style>
        :root {
            --bg-primary: #0f0f0f;
            --bg-secondary: #1a1a1a;
            --bg-tertiary: #252525;
            --text-primary: #ffffff;
            --text-secondary: #a0a0a0;
            --border-color: #2a2a2a;
            --accent-blue: #3b82f6;
            --accent-purple: #8b5cf6;
            --accent-green: #10b981;
        }
        
        .light {
            --bg-primary: #ffffff;
            --bg-secondary: #f9fafb;
            --bg-tertiary: #f3f4f6;
            --text-primary: #111827;
            --text-secondary: #6b7280;
            --border-color: #e5e7eb;
            --accent-blue: #3b82f6;
            --accent-purple: #8b5cf6;
            --accent-green: #10b981;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        
        code, pre {
            font-family: 'JetBrains Mono', monospace;
        }
        
        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--bg-secondary);
            border-radius: 5px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--accent-blue);
            border-radius: 5px;
            opacity: 0.5;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            opacity: 0.8;
        }
        
        /* Glassmorphism */
        .glass {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .glass-light {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(0, 0, 0, 0.1);
        }
        
        /* Gradient text */
        .gradient-text {
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-purple) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        /* Typing indicator */
        .typing-dot {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: var(--accent-blue);
            animation: typing 1.4s infinite ease-in-out both;
        }
        
        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }
        
        @keyframes typing {
            0%, 80%, 100% {
                transform: scale(0.8);
                opacity: 0.5;
            }
            40% {
                transform: scale(1);
                opacity: 1;
            }
        }
        
        /* Message animations */
        .message-fade-in {
            animation: messageFadeIn 0.3s ease-out forwards;
        }
        
        @keyframes messageFadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Code block enhancements */
        .code-header {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
        }
        
        pre[class*="language-"] {
            margin: 0;
            border-radius: 0 0 0.5rem 0.5rem;
        }
        
        /* Model cards */
        .model-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .model-card:hover {
            transform: translateY(-4px) scale(1.02);
        }
        
        .model-card.active {
            box-shadow: 0 0 0 3px var(--accent-blue);
        }
        
        /* Session cards */
        .session-card {
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
        }
        
        .session-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.5s;
        }
        
        .session-card:hover::before {
            left: 100%;
        }
        
        /* Loading skeleton */
        .skeleton {
            background: linear-gradient(90deg, var(--bg-secondary) 25%, var(--bg-tertiary) 50%, var(--bg-secondary) 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }
        
        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        
        /* Tag styles */
        .tag-badge {
            transition: all 0.2s ease;
        }
        
        .tag-badge:hover {
            transform: scale(1.1);
        }
        
        /* Toggle switch */
        .toggle {
            appearance: none;
            width: 48px;
            height: 24px;
            background: #4b5563;
            border-radius: 9999px;
            position: relative;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .toggle:checked {
            background: var(--accent-blue);
        }
        
        .toggle::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: transform 0.3s;
        }
        
        .toggle:checked::after {
            transform: translateX(24px);
        }
        
        /* Particles container */
        #particles-js {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 0;
            pointer-events: none;
        }
        
        /* Custom animations */
        .float-animation {
            animation: float 6s ease-in-out infinite;
        }
        
        /* Enhanced gradients */
        .gradient-border {
            position: relative;
            background: var(--bg-secondary);
            border-radius: 0.75rem;
        }
        
        .gradient-border::before {
            content: '';
            position: absolute;
            inset: -1px;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple), var(--accent-green));
            border-radius: 0.75rem;
            z-index: -1;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .gradient-border:hover::before {
            opacity: 1;
        }
    </style>
</head>
<body x-data="chatbotApp()" x-init="init()" :class="theme">
    <!-- Particles Background -->
    <div id="particles-js"></div>
    
    <!-- Gradient Orbs -->
    <div class="fixed inset-0 overflow-hidden pointer-events-none" x-show="particlesEnabled">
        <div class="absolute -top-40 -right-40 w-96 h-96 bg-purple-500/20 rounded-full blur-3xl animate-pulse-slow"></div>
        <div class="absolute -bottom-40 -left-40 w-96 h-96 bg-blue-500/20 rounded-full blur-3xl animate-pulse-slow" style="animation-delay: 2s"></div>
        <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-96 h-96 bg-pink-500/20 rounded-full blur-3xl animate-pulse-slow" style="animation-delay: 4s"></div>
    </div>
    
    <!-- Main App Container -->
    <div class="relative z-10 flex h-screen">
        <!-- Sidebar -->
        <aside class="w-80 flex flex-col border-r transition-all duration-300"
               :class="[
                   sidebarOpen ? 'translate-x-0' : '-translate-x-full',
                   theme === 'dark' ? 'glass border-gray-700/50' : 'glass-light border-gray-200'
               ]">
            
            <!-- Sidebar Header -->
            <div class="p-6 border-b" :class="theme === 'dark' ? 'border-gray-700/50' : 'border-gray-200'">
                <div class="flex items-center justify-between mb-4">
                    <h1 class="text-2xl font-bold gradient-text">Multi-AI Chat</h1>
                    <button @click="toggleTheme()" 
                            class="p-2 rounded-lg transition-colors"
                            :class="theme === 'dark' ? 'hover:bg-gray-800/50' : 'hover:bg-gray-200/50'">
                        <i class="fas text-lg transition-all duration-300" 
                           :class="theme === 'dark' ? 'fa-sun text-yellow-400' : 'fa-moon text-gray-600'"></i>
                    </button>
                </div>
                
                <!-- Quick Stats -->
                <div class="grid grid-cols-2 gap-2 text-xs">
                    <div class="rounded-lg p-2 text-center transition-colors"
                         :class="theme === 'dark' ? 'bg-gray-800/50' : 'bg-gray-100'">
                        <div class="font-semibold text-blue-400" x-text="stats.totalSessions || 0"></div>
                        <div :class="theme === 'dark' ? 'text-gray-500' : 'text-gray-600'">Sess√µes</div>
                    </div>
                    <div class="rounded-lg p-2 text-center transition-colors"
                         :class="theme === 'dark' ? 'bg-gray-800/50' : 'bg-gray-100'">
                        <div class="font-semibold text-green-400" x-text="stats.totalMessages || 0"></div>
                        <div :class="theme === 'dark' ? 'text-gray-500' : 'text-gray-600'">Mensagens</div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="p-4 space-y-2">
                <button @click="createNewSession()"
                        class="w-full py-3 px-4 bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white font-medium rounded-xl transition-all duration-200 transform hover:scale-[1.02] active:scale-[0.98] flex items-center justify-center gap-2 shadow-lg">
                    <i class="fas fa-plus"></i>
                    Nova Conversa
                </button>
                
                <button @click="showTemplates = true"
                        class="w-full py-2 px-3 rounded-lg transition-colors flex items-center gap-2 text-sm"
                        :class="theme === 'dark' ? 'bg-gray-800/50 hover:bg-gray-700/50' : 'bg-gray-100 hover:bg-gray-200'">
                    <i class="fas fa-file-alt"></i>
                    Templates de Prompts
                </button>
            </div>
            
            <!-- Search Bar -->
            <div class="px-4 mb-2">
                <div class="relative">
                    <input type="text"
                           x-model="sessionSearch"
                           @input="filterSessions()"
                           placeholder="Buscar sess√µes..."
                           class="w-full rounded-lg px-4 py-2 pl-10 text-sm focus:outline-none transition-colors"
                           :class="theme === 'dark' 
                               ? 'bg-gray-800/50 border border-gray-700 focus:border-blue-500' 
                               : 'bg-white border border-gray-300 focus:border-blue-500'">
                    <i class="fas fa-search absolute left-3 top-2.5" 
                       :class="theme === 'dark' ? 'text-gray-500' : 'text-gray-400'"></i>
                </div>
            </div>
            
            <!-- Tags Filter -->
            <div class="px-4 mb-4" x-show="allTags.length > 0">
                <div class="flex items-center gap-2 mb-2">
                    <i class="fas fa-tags text-sm" :class="theme === 'dark' ? 'text-gray-500' : 'text-gray-600'"></i>
                    <span class="text-sm" :class="theme === 'dark' ? 'text-gray-400' : 'text-gray-600'">Filtrar por tags:</span>
                </div>
                <div class="flex flex-wrap gap-1">
                    <button @click="filterTag = null"
                            :class="[
                                'px-2 py-1 text-xs rounded-full border transition-all',
                                !filterTag ? 'bg-blue-500/20 border-blue-500' : 
                                theme === 'dark' ? 'border-gray-600 hover:border-gray-500' : 'border-gray-300 hover:border-gray-400'
                            ]">
                        Todas
                    </button>
                    <template x-for="tag in allTags" :key="tag.tag">
                        <button @click="filterTag = tag.tag"
                                :class="{'border-2': filterTag === tag.tag}"
                                :style="`border-color: ${tag.color}; background-color: ${filterTag === tag.tag ? tag.color + '20' : 'transparent'}`"
                                class="px-2 py-1 text-xs rounded-full border hover:opacity-80 transition-all tag-badge">
                            <span x-text="tag.tag"></span>
                            <span class="ml-1 opacity-60" x-text="`(${tag.count})`"></span>
                        </button>
                    </template>
                </div>
            </div>
            
            <!-- Sessions List -->
            <div class="flex-1 overflow-y-auto px-4 space-y-2">
                <template x-if="filteredSessions.length === 0">
                    <div class="text-center py-8" :class="theme === 'dark' ? 'text-gray-500' : 'text-gray-400'">
                        <i class="fas fa-inbox text-4xl mb-2"></i>
                        <p>Nenhuma sess√£o encontrada</p>
                    </div>
                </template>
                
                <template x-for="session in filteredSessions" :key="session.id">
                    <div @click="loadSession(session.id)"
                         :class="[
                             'session-card p-4 rounded-xl border cursor-pointer group transition-all',
                             currentSession?.id === session.id 
                                 ? 'bg-blue-500/10 border-blue-500/50' 
                                 : theme === 'dark'
                                     ? 'border-gray-700/50 hover:border-gray-600 bg-gray-800/30'
                                     : 'border-gray-200 hover:border-gray-300 bg-white/50'
                         ]">
                        <div class="flex items-start justify-between">
                            <div class="flex-1 min-w-0">
                                <h4 class="font-medium truncate" 
                                    :class="theme === 'dark' ? 'text-gray-200' : 'text-gray-800'" 
                                    x-text="session.name"></h4>
                                <div class="flex items-center gap-2 mt-1">
                                    <span class="text-xs px-2 py-0.5 rounded-full"
                                          :class="getModelColor(session.model)">
                                        <span x-text="getModelIcon(session.model)"></span>
                                        <span x-text="session.model"></span>
                                    </span>
                                    <span class="text-xs" 
                                          :class="theme === 'dark' ? 'text-gray-500' : 'text-gray-600'" 
                                          x-text="formatDate(session.lastAccessed)"></span>
                                </div>
                                <div class="text-xs mt-1" :class="theme === 'dark' ? 'text-gray-500' : 'text-gray-600'">
                                    <i class="fas fa-comment-dots"></i>
                                    <span x-text="session.messageCount"></span> mensagens
                                </div>
                                
                                <!-- Tags -->
                                <div class="flex flex-wrap gap-1 mt-2" x-show="session.tags && session.tags.length > 0">
                                    <template x-for="tag in session.tags" :key="tag.tag">
                                        <span :style="`background-color: ${tag.color}20; border-color: ${tag.color}`"
                                              class="px-2 py-0.5 text-xs rounded-full border">
                                            <span x-text="tag.tag"></span>
                                        </span>
                                    </template>
                                </div>
                            </div>
                            <div class="flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity">
                                <button @click.stop="editSessionTags(session)"
                                        class="p-1.5 rounded transition-colors"
                                        :class="theme === 'dark' 
                                            ? 'hover:bg-gray-700 text-gray-400 hover:text-yellow-400' 
                                            : 'hover:bg-gray-200 text-gray-600 hover:text-yellow-600'">
                                    <i class="fas fa-tags text-xs"></i>
                                </button>
                                <button @click.stop="exportSession(session.id)"
                                        class="p-1.5 rounded transition-colors"
                                        :class="theme === 'dark' 
                                            ? 'hover:bg-gray-700 text-gray-400 hover:text-blue-400' 
                                            : 'hover:bg-gray-200 text-gray-600 hover:text-blue-600'">
                                    <i class="fas fa-download text-xs"></i>
                                </button>
                                <button @click.stop="renameSession(session.id, session.name)"
                                        class="p-1.5 rounded transition-colors"
                                        :class="theme === 'dark' 
                                            ? 'hover:bg-gray-700 text-gray-400 hover:text-green-400' 
                                            : 'hover:bg-gray-200 text-gray-600 hover:text-green-600'">
                                    <i class="fas fa-edit text-xs"></i>
                                </button>
                                <button @click.stop="deleteSession(session.id)"
                                        class="p-1.5 rounded transition-colors"
                                        :class="theme === 'dark' 
                                            ? 'hover:bg-gray-700 text-gray-400 hover:text-red-400' 
                                            : 'hover:bg-gray-200 text-gray-600 hover:text-red-600'">
                                    <i class="fas fa-trash text-xs"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </template>
            </div>
            
            <!-- Sidebar Footer -->
            <div class="p-4 border-t space-y-2" :class="theme === 'dark' ? 'border-gray-700/50' : 'border-gray-200'">
                <button @click="showGlobalSearch = true"
                        class="w-full py-2 px-3 rounded-lg transition-colors flex items-center gap-2 text-sm"
                        :class="theme === 'dark' ? 'bg-gray-800/50 hover:bg-gray-700/50' : 'bg-gray-100 hover:bg-gray-200'">
                    <i class="fas fa-search"></i>
                    Busca Global
                </button>
                <button @click="showFavorites = true"
                        class="w-full py-2 px-3 rounded-lg transition-colors flex items-center gap-2 text-sm"
                        :class="theme === 'dark' ? 'bg-gray-800/50 hover:bg-gray-700/50' : 'bg-gray-100 hover:bg-gray-200'">
                    <i class="fas fa-star"></i>
                    Favoritos
                </button>
                <button @click="showStats = true"
                        class="w-full py-2 px-3 rounded-lg transition-colors flex items-center gap-2 text-sm"
                        :class="theme === 'dark' ? 'bg-gray-800/50 hover:bg-gray-700/50' : 'bg-gray-100 hover:bg-gray-200'">
                    <i class="fas fa-chart-bar"></i>
                    Estat√≠sticas
                </button>
                <button @click="showSettings = true"
                        class="w-full py-2 px-3 rounded-lg transition-colors flex items-center gap-2 text-sm"
                        :class="theme === 'dark' ? 'bg-gray-800/50 hover:bg-gray-700/50' : 'bg-gray-100 hover:bg-gray-200'">
                    <i class="fas fa-cog"></i>
                    Configura√ß√µes
                </button>
            </div>
        </aside>
        
        <!-- Main Content -->
        <main class="flex-1 flex flex-col" :class="theme === 'dark' ? 'bg-gray-900' : 'bg-gray-50'">
            <!-- Header -->
            <header class="px-6 py-4 border-b transition-colors"
                    :class="[
                        theme === 'dark' ? 'glass border-gray-700/50' : 'glass-light border-gray-200'
                    ]">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-4">
                        <button @click="sidebarOpen = !sidebarOpen"
                                class="p-2 rounded-lg transition-colors"
                                :class="theme === 'dark' ? 'hover:bg-gray-800/50' : 'hover:bg-gray-200/50'">
                            <i class="fas fa-bars text-xl"></i>
                        </button>
                        
                        <div x-show="currentSession" class="flex items-center gap-3 animate-fade-in">
                            <h2 class="text-xl font-semibold" x-text="currentSession?.name"></h2>
                            <span :class="theme === 'dark' ? 'text-gray-500' : 'text-gray-400'">‚Ä¢</span>
                            <div class="flex items-center gap-2">
                                <span class="text-sm" :class="theme === 'dark' ? 'text-gray-400' : 'text-gray-600'">Modelo:</span>
                                <span class="text-sm px-2 py-0.5 rounded-full"
                                      :class="getModelColor(currentModel)">
                                    <span x-text="getModelIcon(currentModel)"></span>
                                    <span x-text="currentModel"></span>
                                </span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Model Switcher -->
                    <div class="flex items-center gap-2">
                        <template x-for="model in models" :key="model.id">
                            <button @click="switchModel(model.id)"
                                    :class="[
                                        'model-card px-4 py-2 rounded-xl border transition-all',
                                        currentModel === model.id ? 'active' : '',
                                        theme === 'dark' 
                                            ? 'glass border-gray-700/50 hover:border-gray-600' 
                                            : 'bg-white border-gray-200 hover:border-gray-300'
                                    ]">
                                <span x-text="model.icon" class="text-lg"></span>
                                <span class="ml-2 text-sm hidden sm:inline" x-text="model.name"></span>
                            </button>
                        </template>
                    </div>
                </div>
            </header>
            
            <!-- Messages Container -->
            <div class="flex-1 overflow-y-auto" id="messagesContainer">
                <div class="max-w-4xl mx-auto p-6">
                    <!-- Welcome Screen -->
                    <div x-show="!currentSession || messages.length === 0"
                         class="flex flex-col items-center justify-center min-h-[60vh] animate__animated animate__fadeIn">
                        <div class="text-center max-w-2xl">
                            <div class="mb-6 float-animation">
                                <div class="text-8xl mb-4">ü§ñ</div>
                            </div>
                            <h2 class="text-4xl font-bold mb-4 gradient-text">
                                Bem-vindo ao Multi-AI Chatbot
                            </h2>
                            <p class="text-xl mb-8" :class="theme === 'dark' ? 'text-gray-400' : 'text-gray-600'">
                                Converse com as IAs mais avan√ßadas do mundo em uma √∫nica interface
                            </p>
                            
                            <!-- Feature Cards -->
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                                <div class="gradient-border p-6 hover:scale-105 transition-transform">
                                    <div class="text-3xl mb-3">üåü</div>
                                    <h3 class="font-semibold mb-2">Gemini 2.5 Pro</h3>
                                    <p class="text-sm" :class="theme === 'dark' ? 'text-gray-400' : 'text-gray-600'">
                                        Vers√°til e r√°pido para tarefas gerais
                                    </p>
                                </div>
                                <div class="gradient-border p-6 hover:scale-105 transition-transform">
                                    <div class="text-3xl mb-3">üß†</div>
                                    <h3 class="font-semibold mb-2">DeepSeek Reasoner</h3>
                                    <p class="text-sm" :class="theme === 'dark' ? 'text-gray-400' : 'text-gray-600'">
                                        Racioc√≠nio profundo e an√°lise complexa
                                    </p>
                                </div>
                                <div class="gradient-border p-6 hover:scale-105 transition-transform">
                                    <div class="text-3xl mb-3">‚ö°</div>
                                    <h3 class="font-semibold mb-2">Grok 3 Mini</h3>
                                    <p class="text-sm" :class="theme === 'dark' ? 'text-gray-400' : 'text-gray-600'">
                                        Criativo e com personalidade √∫nica
                                    </p>
                                </div>
                            </div>
                            
                            <!-- Quick Actions -->
                            <div class="flex flex-wrap justify-center gap-3">
                                <button @click="createNewSession()"
                                        class="px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 rounded-xl font-medium transition-all transform hover:scale-105 text-white">
                                    <i class="fas fa-plus mr-2"></i>
                                    Iniciar Nova Conversa
                                </button>
                                <button @click="showTemplates = true"
                                        class="px-6 py-3 gradient-border font-medium transition-all transform hover:scale-105">
                                    <i class="fas fa-file-alt mr-2"></i>
                                    Usar Template
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Messages List -->
                    <div x-show="currentSession && messages.length > 0" class="space-y-6">
                        <template x-for="(message, index) in messages" :key="`msg-${index}-${message.id}`">
                            <div class="message-fade-in" :data-message-id="message.id">
                                <!-- User Message -->
                                <div x-show="message.role === 'user'" class="flex justify-end">
                                    <div class="max-w-3xl">
                                        <div class="flex items-end gap-3">
                                            <div class="rounded-2xl px-6 py-4 shadow-lg"
                                                 :class="theme === 'dark' 
                                                     ? 'glass bg-blue-500/10 border border-blue-500/20' 
                                                     : 'bg-blue-50 border border-blue-200'">
                                                <div class="text-sm mb-1" 
                                                     :class="theme === 'dark' ? 'text-blue-400' : 'text-blue-600'">Voc√™</div>
                                                <div class="whitespace-pre-wrap" x-html="renderMarkdown(message.content)"></div>
                                                <div class="text-xs mt-2" 
                                                     :class="theme === 'dark' ? 'text-gray-500' : 'text-gray-600'" 
                                                     x-text="formatTime(message.timestamp)"></div>
                                            </div>
                                            <div class="w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center flex-shrink-0 shadow-lg">
                                                <i class="fas fa-user text-white text-sm"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Assistant Message -->
                                <div x-show="message.role === 'assistant'" class="flex justify-start">
                                    <div class="max-w-3xl">
                                        <div class="flex items-start gap-3">
                                            <div class="w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0 shadow-lg"
                                                 :class="getModelGradient(message.model)">
                                                <span x-text="getModelIcon(message.model)" class="text-white"></span>
                                            </div>
                                            <div class="flex-1">
                                                <div class="rounded-2xl px-6 py-4 shadow-lg"
                                                     :class="theme === 'dark' 
                                                         ? 'glass border border-gray-700/50' 
                                                         : 'bg-white border border-gray-200'">
                                                    <div class="text-sm mb-1" 
                                                         :class="theme === 'dark' ? 'text-gray-400' : 'text-gray-600'" 
                                                         x-text="message.model"></div>
                                                    <div class="prose max-w-none"
                                                         :class="theme === 'dark' ? 'prose-invert' : ''"
                                                         x-html="renderMessage(message)"></div>
                                                    
                                                    <!-- Action buttons -->
                                                    <div class="flex items-center gap-3 mt-3 pt-3 border-t"
                                                         :class="theme === 'dark' ? 'border-gray-700' : 'border-gray-200'">
                                                        <button @click="toggleFavorite(message.id)"
                                                                :class="message.is_favorite ? 'text-yellow-400' : theme === 'dark' ? 'text-gray-500' : 'text-gray-400'"
                                                                class="hover:text-yellow-400 transition-colors text-sm flex items-center gap-1">
                                                            <i class="fas fa-star"></i>
                                                            <span x-show="message.is_favorite" class="text-xs">Favorito</span>
                                                        </button>
                                                        <button @click="copyMessage(message.content)"
                                                                class="transition-colors text-sm flex items-center gap-1"
                                                                :class="theme === 'dark' 
                                                                    ? 'text-gray-500 hover:text-gray-300' 
                                                                    : 'text-gray-400 hover:text-gray-600'">
                                                            <i class="fas fa-copy"></i>
                                                            <span class="text-xs">Copiar</span>
                                                        </button>
                                                        <span class="text-xs ml-auto" 
                                                              :class="theme === 'dark' ? 'text-gray-500' : 'text-gray-600'" 
                                                              x-text="formatTime(message.timestamp)"></span>
                                                    </div>
                                                </div>
                                                
                                                <!-- Code Snippets -->
                                                <template x-if="message.codeSnippets && message.codeSnippets.length > 0">
                                                    <div class="mt-4 space-y-3">
                                                        <template x-for="(snippet, idx) in message.codeSnippets" :key="`code-${index}-${idx}`">
                                                            <div class="rounded-xl overflow-hidden border shadow-lg animate__animated animate__fadeIn"
                                                                 :class="theme === 'dark' ? 'border-gray-700/50' : 'border-gray-300'">
                                                                <div class="code-header px-4 py-2 flex items-center justify-between">
                                                                    <div class="flex items-center gap-2">
                                                                        <i class="fas fa-code text-gray-400"></i>
                                                                        <span class="text-sm font-medium text-gray-300" x-text="snippet.language || 'c√≥digo'"></span>
                                                                    </div>
                                                                    <button @click="copyCode(snippet.code)"
                                                                            class="px-3 py-1 text-xs rounded-lg transition-colors flex items-center gap-1"
                                                                            :class="theme === 'dark' 
                                                                                ? 'bg-gray-700/50 hover:bg-gray-700' 
                                                                                : 'bg-gray-100 hover:bg-gray-200'">
                                                                        <i class="fas fa-copy"></i>
                                                                        Copiar
                                                                    </button>
                                                                </div>
                                                                <pre class="!mt-0"><code :class="'language-' + (snippet.language || 'text')" x-text="snippet.code"></code></pre>
                                                            </div>
                                                        </template>
                                                    </div>
                                                </template>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </template>
                        
                        <!-- Loading Message -->
                        <div x-show="isLoading" class="flex justify-start animate__animated animate__fadeIn">
                            <div class="max-w-3xl">
                                <div class="flex items-start gap-3">
                                    <div class="w-10 h-10 rounded-full flex items-center justify-center animate-pulse shadow-lg"
                                         :class="getModelGradient(currentModel)">
                                        <span x-text="getModelIcon(currentModel)" class="text-white"></span>
                                    </div>
                                    <div class="rounded-2xl px-6 py-4 shadow-lg"
                                         :class="theme === 'dark' 
                                             ? 'glass border border-gray-700/50' 
                                             : 'bg-white border border-gray-200'">
                                        <div class="text-sm mb-2" 
                                             :class="theme === 'dark' ? 'text-gray-400' : 'text-gray-600'" 
                                             x-text="currentModel"></div>
                                        <div class="flex items-center gap-2">
                                            <span class="typing-dot"></span>
                                            <span class="typing-dot"></span>
                                            <span class="typing-dot"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Input Area -->
            <div class="p-6 border-t transition-colors"
                 :class="[
                     theme === 'dark' ? 'glass border-gray-700/50' : 'glass-light border-gray-200'
                 ]">
                <div class="max-w-4xl mx-auto">
                    <!-- File Upload Preview -->
                    <div x-show="uploadedFiles.length > 0" class="mb-4" x-transition>
                        <div class="flex flex-wrap gap-2">
                            <template x-for="(file, index) in uploadedFiles" :key="index">
                                <div class="flex items-center gap-2 px-3 py-1.5 rounded-lg border"
                                     :class="theme === 'dark' 
                                         ? 'bg-gray-800/50 border-gray-700' 
                                         : 'bg-white border-gray-300'">
                                    <i class="fas fa-file text-gray-400 text-sm"></i>
                                    <span class="text-sm" x-text="file.name"></span>
                                    <button @click="removeFile(index)" class="text-red-400 hover:text-red-300">
                                        <i class="fas fa-times text-sm"></i>
                                    </button>
                                </div>
                            </template>
                        </div>
                    </div>
                    
                    <!-- Input Form -->
                    <form @submit.prevent="sendMessage" class="flex gap-4">
                        <div class="flex-1 relative">
                            <textarea
                                x-model="inputMessage"
                                @keydown.enter="if(!$event.shiftKey && !$event.ctrlKey) { $event.preventDefault(); sendMessage(); }"
                                @input="adjustTextareaHeight"
                                placeholder="Digite sua mensagem... (Enter para enviar, Shift+Enter para nova linha)"
                                rows="1"
                                class="w-full rounded-xl px-4 py-3 pr-12 resize-none focus:outline-none transition-all"
                                :class="theme === 'dark' 
                                    ? 'bg-gray-800/50 border border-gray-700/50 focus:border-blue-500' 
                                    : 'bg-white border border-gray-300 focus:border-blue-500'"
                                :disabled="isLoading || !currentSession"
                                style="min-height: 48px; max-height: 200px;"></textarea>
                            
                            <!-- Character Counter -->
                            <div class="absolute bottom-3 right-3 text-xs"
                                 :class="theme === 'dark' ? 'text-gray-500' : 'text-gray-400'">
                                <span x-text="inputMessage.length"></span>
                            </div>
                        </div>
                        
                        <div class="flex items-end gap-2">
                            <!-- File Upload -->
                            <button type="button"
                                    @click="$refs.fileInput.click()"
                                    class="p-3 rounded-xl border transition-colors"
                                    :class="theme === 'dark' 
                                        ? 'glass border-gray-700/50 hover:border-gray-600' 
                                        : 'bg-white border-gray-300 hover:border-gray-400'"
                                    :disabled="!currentSession">
                                <i class="fas fa-paperclip"></i>
                            </button>
                            <input type="file" x-ref="fileInput" @change="handleFileUpload" multiple class="hidden">
                            
                            <!-- Send Button -->
                            <button type="submit"
                                    :disabled="isLoading || !inputMessage.trim() || !currentSession"
                                    class="px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 disabled:opacity-50 disabled:cursor-not-allowed rounded-xl font-medium transition-all transform hover:scale-105 active:scale-95 disabled:transform-none text-white shadow-lg">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </form>
                    
                    <!-- Quick Actions -->
                    <div class="mt-3 flex items-center justify-between text-xs"
                         :class="theme === 'dark' ? 'text-gray-500' : 'text-gray-600'">
                        <div class="flex items-center gap-4">
                            <button @click="clearChat()" 
                                    class="hover:text-gray-300 transition-colors" 
                                    x-show="messages.length > 0">
                                <i class="fas fa-broom mr-1"></i> Limpar chat
                            </button>
                            <button @click="regenerateLastMessage()" 
                                    class="hover:text-gray-300 transition-colors" 
                                    x-show="messages.length > 0">
                                <i class="fas fa-redo mr-1"></i> Regenerar
                            </button>
                        </div>
                        <div>
                            <span x-show="wsConnected" class="text-green-400">
                                <i class="fas fa-circle text-xs mr-1"></i> Conectado
                            </span>
                            <span x-show="!wsConnected" class="text-red-400">
                                <i class="fas fa-circle text-xs mr-1"></i> Desconectado
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <!-- Templates Modal -->
    <div x-show="showTemplates"
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="transition ease-in duration-200"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0"
         @click.self="showTemplates = false"
         class="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4">
        <div class="rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden animate__animated animate__fadeInUp"
             :class="theme === 'dark' ? 'bg-gray-800' : 'bg-white'"
             @click.stop>
            <div class="p-6 border-b" :class="theme === 'dark' ? 'border-gray-700' : 'border-gray-200'">
                <div class="flex items-center justify-between">
                    <h3 class="text-xl font-semibold">üìù Templates de Prompts</h3>
                    <button @click="showTemplates = false" 
                            class="transition-colors"
                            :class="theme === 'dark' ? 'text-gray-400 hover:text-gray-200' : 'text-gray-600 hover:text-gray-800'">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            
            <div class="p-6 overflow-y-auto">
                <!-- Create new template -->
                <div class="mb-6">
                    <button @click="showCreateTemplate = !showCreateTemplate"
                            class="px-4 py-2 bg-blue-500 hover:bg-blue-600 rounded-lg transition-colors text-white">
                        <i class="fas fa-plus mr-2"></i>
                        Criar Novo Template
                    </button>
                    
                    <div x-show="showCreateTemplate" class="mt-4 p-4 rounded-xl" x-transition
                         :class="theme === 'dark' ? 'glass' : 'bg-gray-100'">
                        <div class="space-y-4">
                            <input type="text" x-model="newTemplate.name"
                                   placeholder="Nome do template"
                                   class="w-full rounded-lg px-4 py-2"
                                   :class="theme === 'dark' 
                                       ? 'bg-gray-700/50 border border-gray-600' 
                                       : 'bg-white border border-gray-300'">
                            <textarea x-model="newTemplate.prompt"
                                      placeholder="Prompt do template..."
                                      rows="4"
                                      class="w-full rounded-lg px-4 py-2"
                                      :class="theme === 'dark' 
                                          ? 'bg-gray-700/50 border border-gray-600' 
                                          : 'bg-white border border-gray-300'"></textarea>
                            <input type="text" x-model="newTemplate.description"
                                   placeholder="Descri√ß√£o (opcional)"
                                   class="w-full rounded-lg px-4 py-2"
                                   :class="theme === 'dark' 
                                       ? 'bg-gray-700/50 border border-gray-600' 
                                       : 'bg-white border border-gray-300'">
                            <select x-model="newTemplate.category"
                                    class="w-full rounded-lg px-4 py-2"
                                    :class="theme === 'dark' 
                                        ? 'bg-gray-700/50 border border-gray-600' 
                                        : 'bg-white border border-gray-300'">
                                <option value="general">Geral</option>
                                <option value="coding">Programa√ß√£o</option>
                                <option value="writing">Escrita</option>
                                <option value="analysis">An√°lise</option>
                                <option value="creative">Criativo</option>
                            </select>
                            <div class="flex justify-end gap-2">
                                <button @click="showCreateTemplate = false"
                                        class="px-4 py-2 rounded-lg transition-colors"
                                        :class="theme === 'dark' 
                                            ? 'bg-gray-700 hover:bg-gray-600' 
                                            : 'bg-gray-200 hover:bg-gray-300'">
                                    Cancelar
                                </button>
                                <button @click="saveTemplate()"
                                        class="px-4 py-2 bg-green-500 hover:bg-green-600 rounded-lg transition-colors text-white">
                                    Salvar Template
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Category filter -->
                <div class="mb-4 flex gap-2 flex-wrap">
                    <button @click="templateFilter = null"
                            :class="[
                                'px-3 py-1 rounded-lg text-sm transition-colors',
                                !templateFilter ? 'bg-blue-500/20 border-blue-500' : '',
                                theme === 'dark' ? 'border-gray-600' : 'border-gray-300'
                            ]"
                            class="border">
                        Todos
                    </button>
                    <button @click="templateFilter = 'coding'"
                            :class="[
                                'px-3 py-1 rounded-lg text-sm transition-colors',
                                templateFilter === 'coding' ? 'bg-blue-500/20 border-blue-500' : '',
                                theme === 'dark' ? 'border-gray-600' : 'border-gray-300'
                            ]"
                            class="border">
                        Programa√ß√£o
                    </button>
                    <button @click="templateFilter = 'writing'"
                            :class="[
                                'px-3 py-1 rounded-lg text-sm transition-colors',
                                templateFilter === 'writing' ? 'bg-blue-500/20 border-blue-500' : '',
                                theme === 'dark' ? 'border-gray-600' : 'border-gray-300'
                            ]"
                            class="border">
                        Escrita
                    </button>
                    <button @click="templateFilter = 'analysis'"
                            :class="[
                                'px-3 py-1 rounded-lg text-sm transition-colors',
                                templateFilter === 'analysis' ? 'bg-blue-500/20 border-blue-500' : '',
                                theme === 'dark' ? 'border-gray-600' : 'border-gray-300'
                            ]"
                            class="border">
                        An√°lise
                    </button>
                </div>
                
                <!-- Templates list -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <template x-for="template in getFilteredTemplates()" :key="template.id">
                        <div class="rounded-xl p-4 border transition-all hover:scale-[1.02]"
                             :class="theme === 'dark' 
                                 ? 'glass hover:border-gray-600 border-gray-700' 
                                 : 'bg-gray-50 hover:border-gray-400 border-gray-300'">
                            <div class="flex items-start justify-between mb-2">
                                <h4 class="font-medium" x-text="template.name"></h4>
                                <span class="text-xs px-2 py-1 rounded-full"
                                      :class="theme === 'dark' ? 'bg-gray-700' : 'bg-gray-200'"
                                      x-text="template.category"></span>
                            </div>
                            <p class="text-sm mb-3" 
                               :class="theme === 'dark' ? 'text-gray-400' : 'text-gray-600'"
                               x-text="template.description || 'Sem descri√ß√£o'"></p>
                            <div class="rounded-lg p-3 mb-3"
                                 :class="theme === 'dark' ? 'bg-gray-900/50' : 'bg-white'">
                                <p class="text-sm whitespace-pre-wrap" x-text="template.prompt"></p>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-xs" :class="theme === 'dark' ? 'text-gray-500' : 'text-gray-600'">
                                    <i class="fas fa-fire"></i>
                                    Usado <span x-text="template.usage_count"></span> vezes
                                </span>
                                <button @click="useTemplate(template)"
                                        class="px-3 py-1 bg-blue-500 hover:bg-blue-600 rounded-lg text-sm transition-colors text-white">
                                    Usar Template
                                </button>
                            </div>
                        </div>
                    </template>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Favorites Modal -->
    <div x-show="showFavorites"
         x-transition
         @click.self="showFavorites = false"
         class="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4">
        <div class="rounded-2xl max-w-3xl w-full max-h-[80vh] overflow-hidden animate__animated animate__fadeInUp"
             :class="theme === 'dark' ? 'bg-gray-800' : 'bg-white'"
             @click.stop>
            <div class="p-6 border-b" :class="theme === 'dark' ? 'border-gray-700' : 'border-gray-200'">
                <div class="flex items-center justify-between">
                    <h3 class="text-xl font-semibold">‚≠ê Mensagens Favoritas</h3>
                    <button @click="showFavorites = false" 
                            class="transition-colors"
                            :class="theme === 'dark' ? 'text-gray-400 hover:text-gray-200' : 'text-gray-600 hover:text-gray-800'">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            
            <div class="p-6 overflow-y-auto">
                <div class="space-y-4">
                    <template x-for="favorite in favorites" :key="favorite.message_id">
                        <div class="rounded-xl p-4 border transition-all hover:scale-[1.01]"
                             :class="theme === 'dark' 
                                 ? 'glass hover:border-gray-600 border-gray-700' 
                                 : 'bg-gray-50 hover:border-gray-400 border-gray-300'">
                            <div class="flex items-start justify-between mb-2">
                                <span class="text-sm" x-text="favorite.session_name"></span>
                                <span class="text-xs" x-text="formatDate(favorite.message_timestamp)"></span>
                            </div>
                            <div class="mb-2">
                                <span class="text-xs px-2 py-1 rounded-full"
                                      :class="favorite.role === 'user' ? 'bg-blue-500/20 text-blue-400' : 'bg-green-500/20 text-green-400'"
                                      x-text="favorite.role === 'user' ? 'Voc√™' : 'IA'"></span>
                            </div>
                            <p x-text="favorite.content"></p>
                            <div x-show="favorite.user_note" class="mt-2 p-2 rounded-lg"
                                 :class="theme === 'dark' ? 'bg-yellow-500/10' : 'bg-yellow-50'">
                                <p class="text-sm text-yellow-600">
                                    <i class="fas fa-sticky-note mr-1"></i>
                                    <span x-text="favorite.user_note"></span>
                                </p>
                            </div>
                        </div>
                    </template>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Global Search Modal -->
    <div x-show="showGlobalSearch"
         x-transition
         @click.self="showGlobalSearch = false"
         class="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4">
        <div class="rounded-2xl max-w-3xl w-full max-h-[80vh] overflow-hidden animate__animated animate__fadeInUp"
             :class="theme === 'dark' ? 'bg-gray-800' : 'bg-white'"
             @click.stop>
            <div class="p-6 border-b" :class="theme === 'dark' ? 'border-gray-700' : 'border-gray-200'">
                <h3 class="text-xl font-semibold mb-4">üîç Busca Global</h3>
                <div class="relative">
                    <input type="text"
                           x-model="globalSearchQuery"
                           @input="performGlobalSearch()"
                           placeholder="Buscar em todas as mensagens..."
                           class="w-full rounded-lg px-4 py-3 pl-10 focus:outline-none"
                           :class="theme === 'dark' 
                               ? 'bg-gray-700/50 border border-gray-600 focus:border-blue-500' 
                               : 'bg-white border border-gray-300 focus:border-blue-500'">
                    <i class="fas fa-search absolute left-3 top-3.5 text-gray-400"></i>
                </div>
            </div>
            
            <div class="p-6 overflow-y-auto">
                <div x-show="searchResults.length === 0 && globalSearchQuery" class="text-center py-8 text-gray-500">
                    <i class="fas fa-search text-4xl mb-2"></i>
                    <p>Nenhum resultado encontrado</p>
                </div>
                
                <div class="space-y-4">
                    <template x-for="result in searchResults" :key="result.id">
                        <div @click="loadSession(result.sessionId)"
                             class="rounded-xl p-4 border cursor-pointer transition-all hover:scale-[1.01]"
                             :class="theme === 'dark' 
                                 ? 'glass hover:border-gray-600 border-gray-700' 
                                 : 'bg-gray-50 hover:border-gray-400 border-gray-300'">
                            <div class="flex items-start justify-between mb-2">
                                <span class="text-sm font-medium" x-text="result.sessionName"></span>
                                <span class="text-xs" x-text="formatDate(result.timestamp)"></span>
                            </div>
                            <p class="text-sm" x-html="highlightSearchTerm(result.preview, globalSearchQuery)"></p>
                            <div class="mt-2">
                                <span class="text-xs px-2 py-1 rounded-full"
                                      :class="getModelColor(result.model)">
                                    <span x-text="getModelIcon(result.model)"></span>
                                    <span x-text="result.model"></span>
                                </span>
                            </div>
                        </div>
                    </template>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Statistics Modal -->
    <div x-show="showStats"
         x-transition
         @click.self="showStats = false"
         class="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4">
        <div class="rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden animate__animated animate__fadeInUp"
             :class="theme === 'dark' ? 'bg-gray-800' : 'bg-white'"
             @click.stop>
            <div class="p-6 border-b" :class="theme === 'dark' ? 'border-gray-700' : 'border-gray-200'">
                <div class="flex items-center justify-between">
                    <h3 class="text-xl font-semibold">üìä Estat√≠sticas</h3>
                    <button @click="showStats = false" 
                            class="transition-colors"
                            :class="theme === 'dark' ? 'text-gray-400 hover:text-gray-200' : 'text-gray-600 hover:text-gray-800'">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            
            <div class="p-6 overflow-y-auto">
                <!-- Overview Cards -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
                    <div class="rounded-xl p-4"
                         :class="theme === 'dark' ? 'glass' : 'bg-gray-100'">
                        <div class="flex items-center justify-between mb-2">
                            <i class="fas fa-folder text-2xl text-blue-400"></i>
                            <span class="text-2xl font-bold" x-text="stats.totalSessions || 0"></span>
                        </div>
                        <p class="text-sm" :class="theme === 'dark' ? 'text-gray-400' : 'text-gray-600'">Sess√µes Totais</p>
                    </div>
                    
                    <div class="rounded-xl p-4"
                         :class="theme === 'dark' ? 'glass' : 'bg-gray-100'">
                        <div class="flex items-center justify-between mb-2">
                            <i class="fas fa-comment-dots text-2xl text-green-400"></i>
                            <span class="text-2xl font-bold" x-text="stats.totalMessages || 0"></span>
                        </div>
                        <p class="text-sm" :class="theme === 'dark' ? 'text-gray-400' : 'text-gray-600'">Mensagens Totais</p>
                    </div>
                    
                    <div class="rounded-xl p-4"
                         :class="theme === 'dark' ? 'glass' : 'bg-gray-100'">
                        <div class="flex items-center justify-between mb-2">
                            <i class="fas fa-code text-2xl text-purple-400"></i>
                            <span class="text-2xl font-bold" x-text="stats.totalCodeSnippets || 0"></span>
                        </div>
                        <p class="text-sm" :class="theme === 'dark' ? 'text-gray-400' : 'text-gray-600'">Snippets de C√≥digo</p>
                    </div>
                    
                    <div class="rounded-xl p-4"
                         :class="theme === 'dark' ? 'glass' : 'bg-gray-100'">
                        <div class="flex items-center justify-between mb-2">
                            <i class="fas fa-file text-2xl text-orange-400"></i>
                            <span class="text-2xl font-bold" x-text="stats.totalFiles || 0"></span>
                        </div>
                        <p class="text-sm" :class="theme === 'dark' ? 'text-gray-400' : 'text-gray-600'">Arquivos Enviados</p>
                    </div>
                </div>
                
                <!-- Charts -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="rounded-xl p-4"
                         :class="theme === 'dark' ? 'glass' : 'bg-gray-100'">
                        <h4 class="font-medium mb-4">Mensagens por Modelo</h4>
                        <canvas id="messagesByModelChart"></canvas>
                    </div>
                    
                    <div class="rounded-xl p-4"
                         :class="theme === 'dark' ? 'glass' : 'bg-gray-100'">
                        <h4 class="font-medium mb-4">Sess√µes por Modelo</h4>
                        <canvas id="sessionsByModelChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Settings Modal -->
    <div x-show="showSettings"
         x-transition
         @click.self="showSettings = false"
         class="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4">
        <div class="rounded-2xl max-w-2xl w-full max-h-[80vh] overflow-hidden animate__animated animate__fadeInUp"
             :class="theme === 'dark' ? 'bg-gray-800' : 'bg-white'"
             @click.stop>
            <div class="p-6 border-b" :class="theme === 'dark' ? 'border-gray-700' : 'border-gray-200'">
                <div class="flex items-center justify-between">
                    <h3 class="text-xl font-semibold">‚öôÔ∏è Configura√ß√µes</h3>
                    <button @click="showSettings = false" 
                            class="transition-colors"
                            :class="theme === 'dark' ? 'text-gray-400 hover:text-gray-200' : 'text-gray-600 hover:text-gray-800'">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            
            <div class="p-6 overflow-y-auto space-y-6">
                <!-- Appearance -->
                <div>
                    <h4 class="font-medium mb-4">Apar√™ncia</h4>
                    <div class="space-y-3">
                        <div class="flex items-center justify-between">
                            <span>Tema</span>
                            <div class="flex items-center gap-2">
                                <button @click="theme = 'light'"
                                        :class="[
                                            'px-3 py-1 rounded-lg transition-colors',
                                            theme === 'light' ? 'bg-blue-500 text-white' : 
                                            theme === 'dark' ? 'bg-gray-700' : 'bg-gray-200'
                                        ]">
                                    <i class="fas fa-sun mr-1"></i> Claro
                                </button>
                                <button @click="theme = 'dark'"
                                        :class="[
                                            'px-3 py-1 rounded-lg transition-colors',
                                            theme === 'dark' ? 'bg-blue-500 text-white' : 
                                            theme === 'dark' ? 'bg-gray-700' : 'bg-gray-200'
                                        ]">
                                    <i class="fas fa-moon mr-1"></i> Escuro
                                </button>
                            </div>
                        </div>
                        
                        <div class="flex items-center justify-between">
                            <span>Efeitos de part√≠culas</span>
                            <input type="checkbox" x-model="particlesEnabled" class="toggle">
                        </div>
                        
                        <div class="flex items-center justify-between">
                            <span>Anima√ß√µes</span>
                            <input type="checkbox" x-model="animationsEnabled" class="toggle" checked>
                        </div>
                    </div>
                </div>
                
                <!-- Chat Settings -->
                <div>
                    <h4 class="font-medium mb-4">Chat</h4>
                    <div class="space-y-3">
                        <div class="flex items-center justify-between">
                            <span>Modelo padr√£o</span>
                            <select x-model="defaultModel"
                                    class="rounded-lg px-3 py-1"
                                    :class="theme === 'dark' 
                                        ? 'bg-gray-700 border border-gray-600' 
                                        : 'bg-white border border-gray-300'">
                                <option value="Gemini 2.5 Pro">Gemini 2.5 Pro</option>
                                <option value="DeepSeek Reasoner">DeepSeek Reasoner</option>
                                <option value="Grok 3 Mini">Grok 3 Mini</option>
                            </select>
                        </div>
                        
                        <div class="flex items-center justify-between">
                            <span>Salvar hist√≥rico automaticamente</span>
                            <input type="checkbox" x-model="autoSaveHistory" class="toggle" checked>
                        </div>
                        
                        <div class="flex items-center justify-between">
                            <span>Mostrar hor√°rio nas mensagens</span>
                            <input type="checkbox" x-model="showMessageTime" class="toggle" checked>
                        </div>
                    </div>
                </div>
                
                <!-- Data Management -->
                <div>
                    <h4 class="font-medium mb-4">Gerenciamento de Dados</h4>
                    <div class="space-y-3">
                        <button @click="exportAllData()"
                                class="w-full py-2 px-4 rounded-lg transition-colors flex items-center justify-center gap-2"
                                :class="theme === 'dark' 
                                    ? 'bg-gray-700 hover:bg-gray-600' 
                                    : 'bg-gray-200 hover:bg-gray-300'">
                            <i class="fas fa-download"></i>
                            Exportar todos os dados
                        </button>
                        
                        <button @click="clearAllData()"
                                class="w-full py-2 px-4 bg-red-500 hover:bg-red-600 text-white rounded-lg transition-colors flex items-center justify-center gap-2">
                            <i class="fas fa-trash"></i>
                            Limpar todos os dados
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- JavaScript -->
    <script>
        function chatbotApp() {
            return {
                // Estados principais
                theme: 'dark',
                sidebarOpen: true,
                sessions: [],
                currentSession: null,
                messages: [],
                inputMessage: '',
                isLoading: false,
                wsConnected: false,
                ws: null,
                
                // Modelos dispon√≠veis
                models: [
                    { id: 'Gemini 2.5 Pro', name: 'Gemini 2.5 Pro', icon: 'üåü' },
                    { id: 'DeepSeek Reasoner', name: 'DeepSeek Reasoner', icon: 'üß†' },
                    { id: 'Grok 3 Mini', name: 'Grok 3 Mini', icon: '‚ö°' }
                ],
                currentModel: 'Gemini 2.5 Pro',
                defaultModel: 'Gemini 2.5 Pro',
                
                // Estados UI
                showTemplates: false,
                showFavorites: false,
                showGlobalSearch: false,
                showStats: false,
                showSettings: false,
                showCreateTemplate: false,
                
                // Busca e filtros
                sessionSearch: '',
                globalSearchQuery: '',
                searchResults: [],
                filteredSessions: [],
                filterTag: null,
                templateFilter: null,
                
                // Templates
                templates: [],
                newTemplate: {
                    name: '',
                    prompt: '',
                    description: '',
                    category: 'general'
                },
                
                // Favoritos e tags
                favorites: [],
                allTags: [],
                
                // Estat√≠sticas
                stats: {
                    totalSessions: 0,
                    totalMessages: 0,
                    totalCodeSnippets: 0,
                    totalFiles: 0,
                    messagesByModel: {},
                    sessionsByModel: {}
                },
                
                // Configura√ß√µes
                particlesEnabled: true,
                animationsEnabled: true,
                autoSaveHistory: true,
                showMessageTime: true,
                
                // Upload de arquivos
                uploadedFiles: [],
                
                // Inicializa√ß√£o
                async init() {
                    // Carregar tema salvo
                    const savedTheme = localStorage.getItem('theme') || 'dark';
                    this.theme = savedTheme;
                    
                    // Carregar configura√ß√µes
                    this.loadSettings();
                    
                    // Conectar WebSocket
                    this.connectWebSocket();
                    
                    // Carregar dados
                    await this.loadSessions();
                    await this.loadTemplates();
                    await this.loadStats();
                    await this.loadTags();
                    
                    // Inicializar part√≠culas
                    if (this.particlesEnabled) {
                        this.initParticles();
                    }
                    
                    // Auto-save peri√≥dico
                    setInterval(() => {
                        if (this.autoSaveHistory && this.currentSession) {
                            this.saveSession();
                        }
                    }, 30000);
                    
                    // Watchers
                    this.$watch('particlesEnabled', (value) => {
                        localStorage.setItem('particlesEnabled', value);
                        if (!value) {
                            const canvas = document.querySelector('#particles-js canvas');
                            if (canvas) canvas.remove();
                        } else {
                            this.initParticles();
                        }
                    });
                    
                    this.$watch('currentModel', (value) => {
                        localStorage.setItem('lastUsedModel', value);
                    });
                    
                    // Adicionar watchers para configura√ß√µes
                    this.$watch('animationsEnabled', () => this.saveSettings());
                    this.$watch('autoSaveHistory', () => this.saveSettings());
                    this.$watch('showMessageTime', () => this.saveSettings());
                    this.$watch('defaultModel', () => this.saveSettings());
                },
                
                // WebSocket
                connectWebSocket() {
                    const wsUrl = `ws://${window.location.host}/ws`;
                    this.ws = new WebSocket(wsUrl);
                    
                    this.ws.onopen = () => {
                        this.wsConnected = true;
                        console.log('WebSocket conectado');
                    };
                    
                    this.ws.onclose = () => {
                        this.wsConnected = false;
                        console.log('WebSocket desconectado');
                        // Reconectar ap√≥s 3 segundos
                        setTimeout(() => this.connectWebSocket(), 3000);
                    };
                    
                    this.ws.onmessage = (event) => {
                        const data = JSON.parse(event.data);
                        this.handleWebSocketMessage(data);
                    };
                    
                    this.ws.onerror = (error) => {
                        console.error('Erro WebSocket:', error);
                    };
                },
                
                handleWebSocketMessage(data) {
                    switch (data.type) {
                        case 'stream_start':
                            this.isLoading = true;
                            this.messages.push({
                                id: Date.now(),
                                role: 'assistant',
                                content: '',
                                model: data.model,
                                timestamp: new Date().toISOString(),
                                codeSnippets: [],
                                is_favorite: false
                            });
                            break;
                            
                        case 'stream':
                            if (this.messages.length > 0) {
                                const lastMessage = this.messages[this.messages.length - 1];
                                if (lastMessage.role === 'assistant') {
                                    lastMessage.content += data.chunk;
                                    this.scrollToBottom();
                                }
                            }
                            break;
                            
                        case 'message_complete':
                            this.isLoading = false;
                            if (this.messages.length > 0) {
                                const lastMessage = this.messages[this.messages.length - 1];
                                if (lastMessage.role === 'assistant') {
                                    lastMessage.codeSnippets = data.codeSnippets || [];
                                }
                            }
                            // Atualizar estat√≠sticas
                            this.stats.totalMessages++;
                            this.highlightCode();
                            break;
                            
                        case 'error':
                            this.isLoading = false;
                            Swal.fire({
                                icon: 'error',
                                title: 'Erro',
                                text: data.message,
                                background: this.theme === 'dark' ? '#1a1a1a' : '#ffffff',
                                color: this.theme === 'dark' ? '#ffffff' : '#000000'
                            });
                            break;
                    }
                },
                
                // Sess√µes
                async loadSessions() {
                    try {
                        const response = await fetch('/api/sessions');
                        const data = await response.json();
                        this.sessions = data;
                        this.filteredSessions = data;
                        this.stats.totalSessions = data.length;
                    } catch (error) {
                        console.error('Erro ao carregar sess√µes:', error);
                    }
                },
                
                async createNewSession() {
                    const { value: sessionName } = await Swal.fire({
                        title: 'Nova Sess√£o',
                        input: 'text',
                        inputLabel: 'Nome da sess√£o',
                        inputPlaceholder: 'Digite o nome da sess√£o...',
                        showCancelButton: true,
                        confirmButtonText: 'Criar',
                        cancelButtonText: 'Cancelar',
                        background: this.theme === 'dark' ? '#1a1a1a' : '#ffffff',
                        color: this.theme === 'dark' ? '#ffffff' : '#000000',
                        inputValidator: (value) => {
                            if (!value) {
                                return 'Por favor, digite um nome para a sess√£o';
                            }
                        }
                    });
                    
                    if (sessionName) {
                        try {
                            const response = await fetch('/api/sessions', {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({
                                    name: sessionName,
                                    model: this.currentModel
                                })
                            });
                            
                            const newSession = await response.json();
                            this.sessions.unshift(newSession);
                            this.loadSession(newSession.id);
                            this.stats.totalSessions++;
                        } catch (error) {
                            console.error('Erro ao criar sess√£o:', error);
                        }
                    }
                },
                
                async loadSession(sessionId) {
                    try {
                        const response = await fetch(`/api/sessions/${sessionId}`);
                        const data = await response.json();
                        
                        this.currentSession = data.session;
                        this.messages = data.messages || [];
                        this.currentModel = data.session.model;
                        
                        // Atualizar UI
                        this.$nextTick(() => {
                            this.scrollToBottom();
                            this.highlightCode();
                        });
                    } catch (error) {
                        console.error('Erro ao carregar sess√£o:', error);
                    }
                },
                
                async renameSession(sessionId, currentName) {
                    const { value: newName } = await Swal.fire({
                        title: 'Renomear Sess√£o',
                        input: 'text',
                        inputValue: currentName,
                        showCancelButton: true,
                        confirmButtonText: 'Renomear',
                        cancelButtonText: 'Cancelar',
                        background: this.theme === 'dark' ? '#1a1a1a' : '#ffffff',
                        color: this.theme === 'dark' ? '#ffffff' : '#000000'
                    });
                    
                    if (newName && newName !== currentName) {
                        try {
                            await fetch(`/api/sessions/${sessionId}`, {
                                method: 'PUT',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({ name: newName })
                            });
                            
                            // Atualizar na lista
                            const session = this.sessions.find(s => s.id === sessionId);
                            if (session) {
                                session.name = newName;
                            }
                            if (this.currentSession?.id === sessionId) {
                                this.currentSession.name = newName;
                            }
                        } catch (error) {
                            console.error('Erro ao renomear sess√£o:', error);
                        }
                    }
                },
                
                async deleteSession(sessionId) {
                    const result = await Swal.fire({
                        title: 'Confirmar exclus√£o',
                        text: 'Tem certeza que deseja excluir esta sess√£o?',
                        icon: 'warning',
                        showCancelButton: true,
                        confirmButtonColor: '#ef4444',
                        confirmButtonText: 'Sim, excluir',
                        cancelButtonText: 'Cancelar',
                        background: this.theme === 'dark' ? '#1a1a1a' : '#ffffff',
                        color: this.theme === 'dark' ? '#ffffff' : '#000000'
                    });
                    
                    if (result.isConfirmed) {
                        try {
                            await fetch(`/api/sessions/${sessionId}`, {
                                method: 'DELETE'
                            });
                            
                            // Remover da lista
                            this.sessions = this.sessions.filter(s => s.id !== sessionId);
                            this.filterSessions();
                            
                            // Se for a sess√£o atual, limpar
                            if (this.currentSession?.id === sessionId) {
                                this.currentSession = null;
                                this.messages = [];
                            }
                            
                            this.stats.totalSessions--;
                            
                            Swal.fire({
                                icon: 'success',
                                title: 'Sess√£o exclu√≠da',
                                showConfirmButton: false,
                                timer: 1500,
                                background: this.theme === 'dark' ? '#1a1a1a' : '#ffffff',
                                color: this.theme === 'dark' ? '#ffffff' : '#000000'
                            });
                        } catch (error) {
                            console.error('Erro ao excluir sess√£o:', error);
                        }
                    }
                },
                
                async exportSession(sessionId) {
                    try {
                        const response = await fetch(`/api/export/${sessionId}`);
                        const blob = await response.blob();
                        
                        // Criar link de download
                        const url = window.URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = `session_${sessionId}_export.json`;
                        document.body.appendChild(a);
                        a.click();
                        window.URL.revokeObjectURL(url);
                        document.body.removeChild(a);
                        
                        Swal.fire({
                            icon: 'success',
                            title: 'Sess√£o exportada',
                            showConfirmButton: false,
                            timer: 1500,
                            background: this.theme === 'dark' ? '#1a1a1a' : '#ffffff',
                            color: this.theme === 'dark' ? '#ffffff' : '#000000'
                        });
                    } catch (error) {
                        console.error('Erro ao exportar sess√£o:', error);
                    }
                },
                
                async saveSession() {
                    // Salva o estado atual da sess√£o
                    if (this.currentSession) {
                        try {
                            await fetch(`/api/sessions/${this.currentSession.id}`, {
                                method: 'PUT',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({
                                    name: this.currentSession.name,
                                    model: this.currentModel
                                })
                            });
                        } catch (error) {
                            console.error('Erro ao salvar sess√£o:', error);
                        }
                    }
                },
                
                // Mensagens
                async sendMessage() {
                    if (!this.inputMessage.trim() || !this.currentSession || this.isLoading) return;
                    
                    const message = this.inputMessage.trim();
                    this.inputMessage = '';
                    
                    // Adicionar mensagem do usu√°rio
                    this.messages.push({
                        id: Date.now(),
                        role: 'user',
                        content: message,
                        timestamp: new Date().toISOString(),
                        model: this.currentModel,
                        is_favorite: false
                    });
                    
                    this.scrollToBottom();
                    
                    // Enviar via WebSocket
                    if (this.ws && this.ws.readyState === WebSocket.OPEN) {
                        this.ws.send(JSON.stringify({
                            type: 'message',
                            sessionId: this.currentSession.id,
                            message: message,
                            model: this.currentModel
                        }));
                    } else {
                        Swal.fire({
                            icon: 'error',
                            title: 'Erro de conex√£o',
                            text: 'WebSocket desconectado. Tentando reconectar...',
                            background: this.theme === 'dark' ? '#1a1a1a' : '#ffffff',
                            color: this.theme === 'dark' ? '#ffffff' : '#000000'
                        });
                    }
                    
                    // Atualizar sess√£o
                    this.currentSession.messageCount++;
                    this.currentSession.lastAccessed = new Date().toISOString();
                    const session = this.sessions.find(s => s.id === this.currentSession.id);
                    if (session) {
                        session.messageCount = this.currentSession.messageCount;
                        session.lastAccessed = this.currentSession.lastAccessed;
                    }
                },
                
                async regenerateLastMessage() {
                    if (!this.currentSession || this.messages.length < 2) return;
                    
                    // Encontrar √∫ltima mensagem do usu√°rio
                    let lastUserMessageIndex = -1;
                    for (let i = this.messages.length - 1; i >= 0; i--) {
                        if (this.messages[i].role === 'user') {
                            lastUserMessageIndex = i;
                            break;
                        }
                    }
                    
                    if (lastUserMessageIndex === -1) return;
                    
                    // Remover mensagens ap√≥s a √∫ltima mensagem do usu√°rio
                    this.messages = this.messages.slice(0, lastUserMessageIndex + 1);
                    
                    // Reenviar √∫ltima mensagem
                    const lastUserMessage = this.messages[lastUserMessageIndex];
                    if (this.ws && this.ws.readyState === WebSocket.OPEN) {
                        this.ws.send(JSON.stringify({
                            type: 'message',
                            sessionId: this.currentSession.id,
                            message: lastUserMessage.content,
                            model: this.currentModel
                        }));
                    }
                },
                
                clearChat() {
                    Swal.fire({
                        title: 'Limpar conversa?',
                        text: 'Isso remover√° todas as mensagens desta sess√£o.',
                        icon: 'warning',
                        showCancelButton: true,
                        confirmButtonColor: '#ef4444',
                        confirmButtonText: 'Sim, limpar',
                        cancelButtonText: 'Cancelar',
                        background: this.theme === 'dark' ? '#1a1a1a' : '#ffffff',
                        color: this.theme === 'dark' ? '#ffffff' : '#000000'
                    }).then((result) => {
                        if (result.isConfirmed) {
                            this.messages = [];
                            this.currentSession.messageCount = 0;
                        }
                    });
                },
                
                copyMessage(content) {
                    navigator.clipboard.writeText(content).then(() => {
                        Swal.fire({
                            icon: 'success',
                            title: 'Copiado!',
                            showConfirmButton: false,
                            timer: 1000,
                            background: this.theme === 'dark' ? '#1a1a1a' : '#ffffff',
                            color: this.theme === 'dark' ? '#ffffff' : '#000000'
                        });
                    });
                },
                
                copyCode(code) {
                    navigator.clipboard.writeText(code).then(() => {
                        Swal.fire({
                            icon: 'success',
                            title: 'C√≥digo copiado!',
                            showConfirmButton: false,
                            timer: 1000,
                            background: this.theme === 'dark' ? '#1a1a1a' : '#ffffff',
                            color: this.theme === 'dark' ? '#ffffff' : '#000000'
                        });
                    });
                },
                
                // Favoritos
                async toggleFavorite(messageId) {
                    if (!this.currentSession) return;
                    
                    try {
                        const response = await fetch(`/api/sessions/${this.currentSession.id}/favorites`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ message_id: messageId })
                        });
                        
                        const result = await response.json();
                        
                        // Atualizar estado local
                        const message = this.messages.find(m => m.id === messageId);
                        if (message) {
                            message.is_favorite = result.favorited;
                        }
                        
                        // Recarregar favoritos se modal estiver aberto
                        if (this.showFavorites) {
                            await this.loadFavorites();
                        }
                    } catch (error) {
                        console.error('Erro ao alternar favorito:', error);
                    }
                },
                
                async loadFavorites() {
                    try {
                        const response = await fetch('/api/favorites');
                        const data = await response.json();
                        this.favorites = data.favorites;
                    } catch (error) {
                        console.error('Erro ao carregar favoritos:', error);
                    }
                },
                
                // Tags
                async editSessionTags(session) {
                    const currentTags = session.tags.map(t => t.tag).join(', ');
                    
                    const { value: tagsInput } = await Swal.fire({
                        title: 'Editar Tags',
                        input: 'text',
                        inputValue: currentTags,
                        inputPlaceholder: 'Digite as tags separadas por v√≠rgula',
                        showCancelButton: true,
                        confirmButtonText: 'Salvar',
                        cancelButtonText: 'Cancelar',
                        background: this.theme === 'dark' ? '#1a1a1a' : '#ffffff',
                        color: this.theme === 'dark' ? '#ffffff' : '#000000'
                    });
                    
                    if (tagsInput !== undefined) {
                        const tags = tagsInput.split(',').map(t => t.trim()).filter(t => t);
                        
                        try {
                            await fetch(`/api/sessions/${session.id}/tags`, {
                                method: 'PUT',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({ tags })
                            });
                            
                            // Atualizar localmente
                            session.tags = tags.map(tag => ({
                                tag,
                                color: '#3b82f6'
                            }));
                            
                            // Recarregar tags
                            await this.loadTags();
                        } catch (error) {
                            console.error('Erro ao atualizar tags:', error);
                        }
                    }
                },
                
                async loadTags() {
                    try {
                        const response = await fetch('/api/tags');
                        const data = await response.json();
                        this.allTags = data.tags;
                    } catch (error) {
                        console.error('Erro ao carregar tags:', error);
                    }
                },
                
                // Templates
                async loadTemplates() {
                    try {
                        const response = await fetch('/api/templates');
                        const data = await response.json();
                        this.templates = data.templates;
                    } catch (error) {
                        console.error('Erro ao carregar templates:', error);
                    }
                },
                
                async saveTemplate() {
                    if (!this.newTemplate.name || !this.newTemplate.prompt) {
                        Swal.fire({
                            icon: 'error',
                            title: 'Campos obrigat√≥rios',
                            text: 'Por favor, preencha o nome e o prompt do template',
                            background: this.theme === 'dark' ? '#1a1a1a' : '#ffffff',
                            color: this.theme === 'dark' ? '#ffffff' : '#000000'
                        });
                        return;
                    }
                    
                    try {
                        await fetch('/api/templates', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(this.newTemplate)
                        });
                        
                        // Limpar formul√°rio
                        this.newTemplate = {
                            name: '',
                            prompt: '',
                            description: '',
                            category: 'general'
                        };
                        
                        this.showCreateTemplate = false;
                        await this.loadTemplates();
                        
                        Swal.fire({
                            icon: 'success',
                            title: 'Template salvo!',
                            showConfirmButton: false,
                            timer: 1500,
                            background: this.theme === 'dark' ? '#1a1a1a' : '#ffffff',
                            color: this.theme === 'dark' ? '#ffffff' : '#000000'
                        });
                    } catch (error) {
                        console.error('Erro ao salvar template:', error);
                    }
                },
                
                async useTemplate(template) {
                    // Registrar uso
                    await fetch(`/api/templates/${template.id}/use`, { method: 'POST' });
                    
                    // Aplicar template
                    this.inputMessage = template.prompt;
                    this.showTemplates = false;
                    
                    // Focar no campo de entrada
                    this.$nextTick(() => {
                        const textarea = document.querySelector('textarea');
                        if (textarea) {
                            textarea.focus();
                            this.adjustTextareaHeight({ target: textarea });
                        }
                    });
                },
                
                // Busca
                filterSessions() {
                    let filtered = this.sessions;
                    
                    // Filtrar por busca
                    if (this.sessionSearch) {
                        const search = this.sessionSearch.toLowerCase();
                        filtered = filtered.filter(s => 
                            s.name.toLowerCase().includes(search) ||
                            s.model.toLowerCase().includes(search)
                        );
                    }
                    
                    // Filtrar por tag
                    if (this.filterTag) {
                        filtered = filtered.filter(s => 
                            s.tags && s.tags.some(t => t.tag === this.filterTag)
                        );
                    }
                    
                    this.filteredSessions = filtered;
                },
                
                async performGlobalSearch() {
                    if (!this.globalSearchQuery) {
                        this.searchResults = [];
                        return;
                    }
                    
                    try {
                        const response = await fetch(`/api/search?q=${encodeURIComponent(this.globalSearchQuery)}`);
                        this.searchResults = await response.json();
                    } catch (error) {
                        console.error('Erro na busca global:', error);
                    }
                },
                
                highlightSearchTerm(text, term) {
                    if (!term) return text;
                    const regex = new RegExp(`(${term})`, 'gi');
                    return text.replace(regex, '<mark class="bg-yellow-300 text-black">$1</mark>');
                },
                
                // Estat√≠sticas
                async loadStats() {
                    try {
                        const response = await fetch('/api/stats');
                        this.stats = await response.json();
                        
                        // Atualizar gr√°ficos se modal estiver aberto
                        if (this.showStats) {
                            this.$nextTick(() => this.updateCharts());
                        }
                    } catch (error) {
                        console.error('Erro ao carregar estat√≠sticas:', error);
                    }
                },
                
                updateCharts() {
                    // Gr√°fico de mensagens por modelo
                    const messagesCtx = document.getElementById('messagesByModelChart');
                    if (messagesCtx) {
                        new Chart(messagesCtx, {
                            type: 'doughnut',
                            data: {
                                labels: Object.keys(this.stats.messagesByModel || {}),
                                datasets: [{
                                    data: Object.values(this.stats.messagesByModel || {}),
                                    backgroundColor: ['#3b82f6', '#8b5cf6', '#10b981']
                                }]
                            },
                            options: {
                                responsive: true,
                                plugins: {
                                    legend: {
                                        labels: {
                                            color: this.theme === 'dark' ? '#ffffff' : '#000000'
                                        }
                                    }
                                }
                            }
                        });
                    }
                    
                    // Gr√°fico de sess√µes por modelo
                    const sessionsCtx = document.getElementById('sessionsByModelChart');
                    if (sessionsCtx) {
                        new Chart(sessionsCtx, {
                            type: 'bar',
                            data: {
                                labels: Object.keys(this.stats.sessionsByModel || {}),
                                datasets: [{
                                    label: 'Sess√µes',
                                    data: Object.values(this.stats.sessionsByModel || {}),
                                    backgroundColor: ['#3b82f6', '#8b5cf6', '#10b981']
                                }]
                            },
                            options: {
                                responsive: true,
                                scales: {
                                    y: {
                                        beginAtZero: true,
                                        ticks: {
                                            color: this.theme === 'dark' ? '#ffffff' : '#000000'
                                        }
                                    },
                                    x: {
                                        ticks: {
                                            color: this.theme === 'dark' ? '#ffffff' : '#000000'
                                        }
                                    }
                                },
                                plugins: {
                                    legend: {
                                        display: false
                                    }
                                }
                            }
                        });
                    }
                },
                
                // Configura√ß√µes
                toggleTheme() {
                    this.theme = this.theme === 'dark' ? 'light' : 'dark';
                    localStorage.setItem('theme', this.theme);
                    
                    // Atualizar gr√°ficos se necess√°rio
                    if (this.showStats) {
                        this.$nextTick(() => this.updateCharts());
                    }
                },
                
                loadSettings() {
                    // Carregar configura√ß√µes do localStorage
                    this.particlesEnabled = localStorage.getItem('particlesEnabled') !== 'false';
                    this.animationsEnabled = localStorage.getItem('animationsEnabled') !== 'false';
                    this.autoSaveHistory = localStorage.getItem('autoSaveHistory') !== 'false';
                    this.showMessageTime = localStorage.getItem('showMessageTime') !== 'false';
                    this.defaultModel = localStorage.getItem('defaultModel') || 'Gemini 2.5 Pro';
                },
                
                saveSettings() {
                    localStorage.setItem('particlesEnabled', this.particlesEnabled);
                    localStorage.setItem('animationsEnabled', this.animationsEnabled);
                    localStorage.setItem('autoSaveHistory', this.autoSaveHistory);
                    localStorage.setItem('showMessageTime', this.showMessageTime);
                    localStorage.setItem('defaultModel', this.defaultModel);
                },
                
                async exportAllData() {
                    // Implementar exporta√ß√£o de todos os dados
                    Swal.fire({
                        icon: 'info',
                        title: 'Em desenvolvimento',
                        text: 'Esta funcionalidade ser√° implementada em breve',
                        background: this.theme === 'dark' ? '#1a1a1a' : '#ffffff',
                        color: this.theme === 'dark' ? '#ffffff' : '#000000'
                    });
                },
                
                async clearAllData() {
                    const result = await Swal.fire({
                        title: 'Limpar todos os dados?',
                        text: 'Esta a√ß√£o n√£o pode ser desfeita!',
                        icon: 'warning',
                        showCancelButton: true,
                        confirmButtonColor: '#ef4444',
                        confirmButtonText: 'Sim, limpar tudo',
                        cancelButtonText: 'Cancelar',
                        background: this.theme === 'dark' ? '#1a1a1a' : '#ffffff',
                        color: this.theme === 'dark' ? '#ffffff' : '#000000'
                    });
                    
                    if (result.isConfirmed) {
                        // Implementar limpeza de dados
                        localStorage.clear();
                        location.reload();
                    }
                },
                
                // Upload de arquivos
                handleFileUpload(event) {
                    const files = Array.from(event.target.files);
                    this.uploadedFiles.push(...files);
                },
                
                removeFile(index) {
                    this.uploadedFiles.splice(index, 1);
                },
                
                // Modelos
                switchModel(modelId) {
                    this.currentModel = modelId;
                    
                    // Atualizar modelo da sess√£o se houver sess√£o ativa
                    if (this.currentSession) {
                        fetch(`/api/sessions/${this.currentSession.id}/model`, {
                            method: 'PUT',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ model: modelId })
                        });
                    }
                },
                
                // Utilit√°rios
                scrollToBottom() {
                    this.$nextTick(() => {
                        const container = document.getElementById('messagesContainer');
                        if (container) {
                            container.scrollTop = container.scrollHeight;
                        }
                    });
                },
                
                adjustTextareaHeight(event) {
                    const textarea = event.target;
                    textarea.style.height = 'auto';
                    textarea.style.height = Math.min(textarea.scrollHeight, 200) + 'px';
                },
                
                highlightCode() {
                    this.$nextTick(() => {
                        Prism.highlightAll();
                    });
                },
                
                renderMarkdown(text) {
                    return marked.parse(text);
                },
                
                renderMessage(message) {
                    let content = this.renderMarkdown(message.content);
                    
                    // Adicionar placeholders para c√≥digo se houver snippets
                    if (message.codeSnippets && message.codeSnippets.length > 0) {
                        message.codeSnippets.forEach(snippet => {
                            const placeholder = `[C√ìDIGO ${snippet.position + 1}: ${snippet.language}]`;
                            const codeBlock = `<div class="code-snippet-placeholder" data-position="${snippet.position}"></div>`;
                            content = content.replace(placeholder, codeBlock);
                        });
                    }
                    
                    return content;
                },
                
                formatDate(dateStr) {
                    const date = new Date(dateStr);
                    return date.toLocaleDateString('pt-BR', {
                        day: '2-digit',
                        month: '2-digit',
                        year: 'numeric'
                    });
                },
                
                formatTime(dateStr) {
                    if (!this.showMessageTime) return '';
                    const date = new Date(dateStr);
                    return date.toLocaleTimeString('pt-BR', {
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                },
                
                getModelIcon(model) {
                    const icons = {
                        'Gemini 2.5 Pro': 'üåü',
                        'DeepSeek Reasoner': 'üß†',
                        'Grok 3 Mini': '‚ö°',
                        'GEMINI': 'üåü',
                        'DEEPSEEK': 'üß†',
                        'GROK': '‚ö°'
                    };
                    return icons[model] || 'ü§ñ';
                },
                
                getModelColor(model) {
                    const colors = {
                        'Gemini 2.5 Pro': 'bg-blue-500/20 text-blue-400',
                        'DeepSeek Reasoner': 'bg-purple-500/20 text-purple-400',
                        'Grok 3 Mini': 'bg-green-500/20 text-green-400',
                        'GEMINI': 'bg-blue-500/20 text-blue-400',
                        'DEEPSEEK': 'bg-purple-500/20 text-purple-400',
                        'GROK': 'bg-green-500/20 text-green-400'
                    };
                    return colors[model] || 'bg-gray-500/20 text-gray-400';
                },
                
                getModelGradient(model) {
                    const gradients = {
                        'Gemini 2.5 Pro': 'bg-gradient-to-br from-blue-500 to-blue-600',
                        'DeepSeek Reasoner': 'bg-gradient-to-br from-purple-500 to-purple-600',
                        'Grok 3 Mini': 'bg-gradient-to-br from-green-500 to-green-600',
                        'GEMINI': 'bg-gradient-to-br from-blue-500 to-blue-600',
                        'DEEPSEEK': 'bg-gradient-to-br from-purple-500 to-purple-600',
                        'GROK': 'bg-gradient-to-br from-green-500 to-green-600'
                    };
                    return gradients[model] || 'bg-gradient-to-br from-gray-500 to-gray-600';
                },
                
                // Part√≠culas
                initParticles() {
                    if (typeof particlesJS !== 'undefined') {
                        particlesJS('particles-js', {
                            particles: {
                                number: {
                                    value: 80,
                                    density: { enable: true, value_area: 800 }
                                },
                                color: { value: '#3b82f6' },
                                shape: { type: 'circle' },
                                opacity: {
                                    value: 0.3,
                                    random: false,
                                    anim: { enable: false }
                                },
                                size: {
                                    value: 3,
                                    random: true,
                                    anim: { enable: false }
                                },
                                line_linked: {
                                    enable: true,
                                    distance: 150,
                                    color: '#3b82f6',
                                    opacity: 0.2,
                                    width: 1
                                },
                                move: {
                                    enable: true,
                                    speed: 2,
                                    direction: 'none',
                                    random: false,
                                    straight: false,
                                    out_mode: 'out',
                                    bounce: false
                                }
                            },
                            interactivity: {
                                detect_on: 'canvas',
                                events: {
                                    onhover: { enable: true, mode: 'repulse' },
                                    onclick: { enable: true, mode: 'push' },
                                    resize: true
                                },
                                modes: {
                                    repulse: { distance: 100, duration: 0.4 },
                                    push: { particles_nb: 4 }
                                }
                            },
                            retina_detect: true
                        });
                    }
                },
                
                // M√©todo getter para templates filtrados
                getFilteredTemplates() {
                    if (!this.templateFilter) return this.templates;
                    return this.templates.filter(t => t.category === this.templateFilter);
                },
                
                // Computed properties
                get filteredTemplates() {
                    if (!this.templateFilter) return this.templates;
                    return this.templates.filter(t => t.category === this.templateFilter);
                }
            }
        }
    </script>
</body>
</html>